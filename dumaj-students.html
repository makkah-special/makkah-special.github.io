<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¨ÙˆØ§Ø¨Ø© Ù…Ù„ÙØ§Øª Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„ÙÙƒØ±ÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #7c2d12;
  --orange:  #c25a00;
  --orange2: #e07020;
  --bg:      #fff8f4;
  --card:    #ffffff;
  --border:  #f5d0b0;
  --text:    #2e1a0a;
  --muted:   #9a6a4a;
  --red:     #dc2626;
  --radius:  14px;
  --shadow:  0 4px 20px rgba(194,90,0,0.10);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Cairo',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; }

/* ===== LOGIN ===== */
#login-screen {
  min-height:100vh; display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  background: linear-gradient(135deg, #7c2d12 0%, #c25a00 100%);
  padding:20px;
}
.login-logo { font-size:3rem; margin-bottom:12px; }
.login-title { color:#fff; font-size:1.4rem; font-weight:900; margin-bottom:4px; }
.login-sub   { color:rgba(255,255,255,0.75); font-size:0.85rem; margin-bottom:32px; }
.login-box {
  background:#fff; border-radius:20px; padding:28px 24px;
  width:100%; max-width:360px; box-shadow:0 20px 60px rgba(0,0,0,0.25);
}
.login-box label { font-size:0.82rem; font-weight:700; color:var(--muted); display:block; margin-bottom:8px; }
.login-input {
  width:100%; padding:13px 16px; border-radius:12px;
  border:2px solid var(--border); font-family:'Cairo',sans-serif;
  font-size:1rem; text-align:center; letter-spacing:4px; font-weight:800;
  outline:none; transition:border-color 0.2s;
}
.login-input:focus { border-color:var(--orange); }
.login-input.error { border-color:var(--red); animation:shake 0.3s; }
@keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }
.login-btn {
  width:100%; margin-top:14px; padding:14px; border-radius:12px;
  background: linear-gradient(135deg, #c25a00, #e07020);
  color:#fff; font-family:'Cairo',sans-serif; font-size:1rem;
  font-weight:800; border:none; cursor:pointer; transition:all 0.2s;
}
.login-btn:hover { transform:translateY(-2px); box-shadow:0 8px 20px rgba(194,90,0,0.3); }
.login-error { color:var(--red); font-size:0.8rem; margin-top:8px; text-align:center; display:none; }
.login-error.show { display:block; }

/* ===== STUDENT PORTAL ===== */
#student-portal { display:none; min-height:100vh; }
.sp-header {
  background: linear-gradient(135deg, #7c2d12, #c25a00);
  padding:16px 20px; display:flex; align-items:center;
  justify-content:space-between; gap:12px;
}
.sp-header-info { display:flex; align-items:center; gap:14px; }
.sp-photo-wrap { position:relative; }
.sp-photo {
  width:54px; height:54px; border-radius:50%; border:3px solid rgba(255,255,255,0.4);
  object-fit:cover; display:none;
}
.sp-photo-emoji {
  width:54px; height:54px; border-radius:50%; background:rgba(255,255,255,0.15);
  border:3px solid rgba(255,255,255,0.3);
  display:flex; align-items:center; justify-content:center; font-size:1.6rem;
}
.sp-photo-edit {
  position:absolute; bottom:-2px; left:-2px;
  background:var(--orange2); color:#fff;
  width:22px; height:22px; border-radius:50%; font-size:0.65rem;
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; border:none;
}
#photo-input { display:none; }
.sp-name { color:#fff; font-size:1rem; font-weight:800; }
.sp-meta { color:rgba(255,255,255,0.75); font-size:0.75rem; margin-top:2px; }
.sp-logout {
  background:rgba(255,255,255,0.15); color:#fff; border:1px solid rgba(255,255,255,0.3);
  padding:8px 14px; border-radius:10px; font-family:'Cairo',sans-serif;
  font-size:0.8rem; font-weight:700; cursor:pointer;
}

.sp-tabs {
  background:#fff; border-bottom:2px solid var(--border);
  display:flex; overflow-x:auto; padding:0 16px;
  position:sticky; top:0; z-index:50;
  box-shadow:0 2px 12px rgba(0,0,0,0.06);
}
.sp-tab {
  padding:14px 16px; font-family:'Cairo',sans-serif; font-size:0.82rem;
  font-weight:700; color:var(--muted); border:none; background:none;
  cursor:pointer; border-bottom:3px solid transparent; white-space:nowrap;
  transition:all 0.2s;
}
.sp-tab.active { color:var(--orange); border-bottom-color:var(--orange); }

.sp-body { padding:16px; }
.sp-pane { display:none; }
.sp-pane.active { display:block; }

.info-card {
  background:#fff; border-radius:var(--radius); border:1px solid var(--border);
  padding:16px; margin-bottom:14px; box-shadow:var(--shadow);
}
.info-card-title {
  font-size:0.85rem; font-weight:800; color:var(--primary);
  margin-bottom:12px; padding-bottom:8px; border-bottom:1px solid var(--border);
}
.info-row { display:flex; align-items:flex-start; gap:10px; padding:7px 0; border-bottom:1px solid #fdf0e8; }
.info-row:last-child { border-bottom:none; }
.info-label { font-size:0.78rem; color:var(--muted); font-weight:700; min-width:120px; flex-shrink:0; }
.info-value { font-size:0.82rem; font-weight:600; }

.plan-card {
  background:#fff; border-radius:var(--radius); border:1px solid var(--border);
  padding:14px 16px; margin-bottom:10px; border-right:4px solid var(--orange);
  box-shadow:var(--shadow);
}
.plan-card-title { font-size:0.88rem; font-weight:800; color:var(--primary); margin-bottom:4px; }
.plan-card-desc  { font-size:0.8rem; color:var(--muted); line-height:1.6; }

.fu-table { width:100%; border-collapse:collapse; background:#fff; border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow); }
.fu-table th { background:var(--primary); color:#fff; padding:10px 8px; font-size:0.75rem; text-align:center; }
.fu-table td { padding:9px 8px; font-size:0.78rem; border-bottom:1px solid var(--border); text-align:center; }
.fu-table tr:last-child td { border-bottom:none; }
.fu-table td:first-child { text-align:right; font-weight:700; }
.fu-val-check { color:#16a34a; font-weight:800; }
.fu-val-part  { color:#d97706; font-weight:800; }
.fu-val-no    { color:#dc2626; font-weight:800; }

.pdf-section { background:#fff; border-radius:var(--radius); border:1px solid var(--border); padding:14px; margin-bottom:12px; box-shadow:var(--shadow); }
.pdf-title { font-size:0.85rem; font-weight:800; color:var(--primary); margin-bottom:10px; }
.pdf-upload-btn {
  display:block; width:100%; padding:12px; text-align:center;
  border:2px dashed var(--border); border-radius:10px;
  font-family:'Cairo',sans-serif; font-size:0.82rem; font-weight:700;
  color:var(--muted); background:#fffaf6; cursor:pointer; transition:all 0.2s;
}
.pdf-upload-btn:hover { border-color:var(--orange); color:var(--orange); background:#fff8f4; }
.pdf-iframe { width:100%; height:400px; border:1px solid var(--border); border-radius:8px; margin-top:8px; }

/* ===== ADMIN ===== */
#admin-portal { display:none; min-height:100vh; }
.ap-header {
  background: linear-gradient(135deg, #7c2d12, #c25a00);
  padding:14px 20px; display:flex; align-items:center;
  justify-content:space-between; gap:12px; flex-wrap:wrap;
}
.ap-header h1 { color:#fff; font-size:1rem; font-weight:800; }
.ap-header-btns { display:flex; gap:8px; flex-wrap:wrap; }
.ap-btn {
  padding:8px 14px; border-radius:10px; font-family:'Cairo',sans-serif;
  font-size:0.8rem; font-weight:700; cursor:pointer; border:none; transition:all 0.2s;
}
.ap-btn-ghost  { background:rgba(255,255,255,0.15); color:#fff; border:1px solid rgba(255,255,255,0.3); }
.ap-btn-orange { background:var(--orange2); color:#fff; }

.ap-tabs {
  background:#fff; border-bottom:2px solid var(--border);
  display:flex; padding:0 16px; position:sticky; top:0; z-index:50;
  box-shadow:0 2px 12px rgba(0,0,0,0.06);
}
.ap-tab {
  padding:13px 16px; font-family:'Cairo',sans-serif; font-size:0.82rem;
  font-weight:700; color:var(--muted); border:none; background:none;
  cursor:pointer; border-bottom:3px solid transparent; white-space:nowrap;
}
.ap-tab.active { color:var(--orange); border-bottom-color:var(--orange); }

.ap-body { padding:16px; }
.ap-pane { display:none; }
.ap-pane.active { display:block; }

.ap-search-row { display:flex; gap:10px; margin-bottom:16px; align-items:center; }
.ap-search {
  flex:1; padding:10px 14px; border-radius:10px; border:1.5px solid var(--border);
  font-family:'Cairo',sans-serif; font-size:0.85rem; outline:none;
}
.ap-search:focus { border-color:var(--orange); }
.ap-count { font-size:0.8rem; font-weight:700; color:var(--muted); white-space:nowrap; }

.students-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:12px; }
.stu-card {
  background:#fff; border-radius:var(--radius); border:1px solid var(--border);
  padding:14px 16px; cursor:pointer; transition:all 0.2s;
  display:flex; align-items:center; gap:12px; box-shadow:var(--shadow);
}
.stu-card:hover { transform:translateY(-2px); border-color:var(--orange); box-shadow:0 8px 24px rgba(194,90,0,0.15); }
.stu-card-num {
  background: linear-gradient(135deg, #c25a00, #e07020);
  color:#fff; width:36px; height:36px; border-radius:10px;
  display:flex; align-items:center; justify-content:center;
  font-size:0.78rem; font-weight:800; flex-shrink:0;
}
.stu-card-name { font-size:0.88rem; font-weight:800; }
.stu-card-meta { font-size:0.72rem; color:var(--muted); margin-top:2px; }
.stu-card-pin  { font-size:0.68rem; background:#fff8f4; color:var(--orange); padding:2px 8px; border-radius:20px; font-weight:700; }

.add-form {
  background:#fff; border-radius:var(--radius); border:1px solid var(--border);
  padding:20px; box-shadow:var(--shadow);
}
.add-form h3 { font-size:0.95rem; font-weight:800; color:var(--primary); margin-bottom:16px; }
.form-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.form-group { display:flex; flex-direction:column; gap:6px; }
.form-group.full { grid-column:1/-1; }
.form-label { font-size:0.78rem; font-weight:700; color:var(--muted); }
.form-input {
  padding:10px 12px; border-radius:10px; border:1.5px solid var(--border);
  font-family:'Cairo',sans-serif; font-size:0.85rem; outline:none;
  transition:border-color 0.2s; background:#fff;
}
.form-input:focus { border-color:var(--orange); }
textarea.form-input { resize:vertical; min-height:70px; }
select.form-input { cursor:pointer; }
.pin-preview {
  text-align:center; background: linear-gradient(135deg,#fff8f4,#fff);
  border:2px solid var(--orange); border-radius:10px; padding:10px;
  font-size:1.2rem; font-weight:900; color:var(--orange); letter-spacing:4px;
}

/* ===== MODAL ===== */
#edit-modal {
  position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1000;
  display:none; align-items:flex-start; justify-content:center;
  padding:16px; overflow-y:auto;
}
#edit-modal.open { display:flex; }
.modal-box {
  background:#fff; border-radius:20px; width:100%; max-width:600px;
  margin:auto; box-shadow:0 20px 60px rgba(0,0,0,0.25);
  max-height:90vh; overflow-y:auto;
}
.modal-header {
  background: linear-gradient(135deg, #7c2d12, #c25a00);
  padding:16px 20px; border-radius:20px 20px 0 0;
  display:flex; align-items:center; justify-content:space-between;
}
.modal-header h3 { color:#fff; font-size:0.95rem; font-weight:800; }
.modal-close {
  background:rgba(255,255,255,0.2); color:#fff; border:none;
  width:30px; height:30px; border-radius:50%; font-size:1rem;
  cursor:pointer; display:flex; align-items:center; justify-content:center;
}
.modal-body { padding:20px; }

.modal-tabs { display:flex; gap:4px; background:#f5f5f5; border-radius:10px; padding:4px; margin-bottom:20px; flex-wrap:wrap; }
.modal-tab {
  flex:1; padding:8px 6px; border:none; border-radius:8px; cursor:pointer;
  font-family:'Cairo',sans-serif; font-size:0.75rem; font-weight:700;
  color:var(--muted); background:none; white-space:nowrap; transition:all 0.2s;
}
.modal-tab.active { background:#fff; color:var(--orange); box-shadow:0 2px 8px rgba(0,0,0,0.1); }

.modal-pane { display:none; }
.modal-pane.active { display:block; }

.modal-actions {
  display:flex; gap:10px; justify-content:flex-end;
  padding-top:16px; border-top:1px solid var(--border); margin-top:16px;
}
.btn-save {
  background: linear-gradient(135deg, #c25a00, #e07020);
  color:#fff; padding:10px 24px; border-radius:10px; border:none;
  font-family:'Cairo',sans-serif; font-size:0.88rem; font-weight:800; cursor:pointer;
}
.btn-cancel {
  background:#f5f5f5; color:var(--muted); padding:10px 18px; border-radius:10px;
  border:none; font-family:'Cairo',sans-serif; font-size:0.85rem; font-weight:700; cursor:pointer;
}
.btn-delete {
  background:#fee2e2; color:var(--red); padding:10px 18px; border-radius:10px;
  border:none; font-family:'Cairo',sans-serif; font-size:0.85rem; font-weight:700;
  cursor:pointer; margin-left:auto;
}

.plan-row {
  display:grid; grid-template-columns:1fr 1fr 28px; gap:8px;
  margin-bottom:8px; align-items:center;
}
.plan-row-del {
  background:#fee2e2; color:var(--red); border:none; border-radius:8px;
  width:28px; height:28px; cursor:pointer; font-size:0.9rem; font-weight:800;
}
.btn-add {
  width:100%; padding:10px; border:2px dashed var(--border); border-radius:10px;
  background:none; font-family:'Cairo',sans-serif; font-size:0.82rem;
  font-weight:700; color:var(--muted); cursor:pointer; margin-top:8px; transition:all 0.2s;
}
.btn-add:hover { border-color:var(--orange); color:var(--orange); background:#fff8f4; }

.fu-editor-row {
  display:grid; grid-template-columns:2fr 1fr 1fr 1fr 1fr 1fr 28px;
  gap:6px; margin-bottom:6px; align-items:center;
}
.fu-head { display:grid; grid-template-columns:2fr 1fr 1fr 1fr 1fr 1fr 28px; gap:6px; margin-bottom:6px; }
.fu-head-cell { font-size:0.72rem; font-weight:700; color:var(--muted); text-align:center; }
.fu-select {
  padding:5px 2px; border-radius:6px; border:1px solid var(--border);
  font-family:'Cairo',sans-serif; font-size:0.75rem; text-align:center;
  background:#fff; cursor:pointer;
}

#toast {
  position:fixed; bottom:24px; right:24px; z-index:9999;
  background:var(--primary); color:#fff; padding:12px 20px;
  border-radius:12px; font-size:0.85rem; font-weight:700;
  box-shadow:0 8px 24px rgba(0,0,0,0.2);
  transform:translateY(80px); opacity:0; transition:all 0.3s; pointer-events:none;
}
#toast.show { transform:translateY(0); opacity:1; }

@media(max-width:480px) {
  .form-grid { grid-template-columns:1fr; }
  .fu-editor-row { grid-template-columns:2fr 1fr 1fr 1fr 28px; }
  .fu-head { grid-template-columns:2fr 1fr 1fr 1fr 28px; }
  .fu-editor-row .col-m4, .fu-editor-row .col-m5,
  .fu-head .col-m4, .fu-head .col-m5 { display:none; }
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-logo">ğŸ§ </div>
  <div class="login-title">Ø¨ÙˆØ§Ø¨Ø© Ù…Ù„ÙØ§Øª Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„ÙÙƒØ±ÙŠ</div>
  <div class="login-sub">Ù…Ø¯Ø±Ø³Ø© Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</div>
  <div class="login-box">
    <label>Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
    <input class="login-input" id="pin-input" type="password" inputmode="numeric" maxlength="10" placeholder="â— â— â— â—" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="login-btn" onclick="doLogin()">Ø¯Ø®ÙˆÙ„</button>
    <div class="login-error" id="login-error">Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</div>
  </div>
</div>

<!-- STUDENT PORTAL -->
<div id="student-portal">
  <div class="sp-header">
    <div class="sp-header-info">
      <div class="sp-photo-wrap">
        <img class="sp-photo" id="sp-photo-img">
        <div class="sp-photo-emoji" id="sp-photo-emoji">ğŸ“</div>
        <button class="sp-photo-edit" onclick="document.getElementById('photo-input').click()">âœï¸</button>
        <input type="file" id="photo-input" accept="image/*" onchange="uploadPhoto(this)">
      </div>
      <div>
        <div class="sp-name" id="sp-name">â€”</div>
        <div class="sp-meta" id="sp-meta">â€”</div>
      </div>
    </div>
    <button class="sp-logout" onclick="doLogout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
  </div>
  <div class="sp-tabs">
    <button class="sp-tab active" onclick="spTab('info',this)">ğŸ‘¤ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <button class="sp-tab" onclick="spTab('plan',this)">ğŸ“‹ Ø§Ù„Ø®Ø·Ø©</button>
    <button class="sp-tab" onclick="spTab('followup',this)">ğŸ“Š Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</button>
    <button class="sp-tab" onclick="spTab('reports',this)">ğŸ“ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚</button>
  </div>
  <div class="sp-body">
    <div class="sp-pane active" id="sp-pane-info">
      <div class="info-card">
        <div class="info-card-title">ğŸ‘¤ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
        <div id="info-basic"></div>
      </div>
      <div class="info-card" id="info-details-card" style="display:none;">
        <div class="info-card-title">ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</div>
        <div id="info-details"></div>
      </div>
    </div>
    <div class="sp-pane" id="sp-pane-plan"><div id="sp-plan-list"></div></div>
    <div class="sp-pane" id="sp-pane-followup">
      <div style="overflow-x:auto;"><table class="fu-table" id="sp-fu-table"></table></div>
    </div>
    <div class="sp-pane" id="sp-pane-reports"><div id="sp-reports-list"></div></div>
  </div>
</div>

<!-- ADMIN PORTAL -->
<div id="admin-portal">
  <div class="ap-header">
    <h1>ğŸ”§ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„ÙÙƒØ±ÙŠ</h1>
    <div class="ap-header-btns">
      <a href="attendance_dumaj.html" target="_blank" class="ap-btn ap-btn-orange" style="text-decoration:none;">ğŸ“‹ ÙƒØ´Ù Ø§Ù„Ø­Ø¶ÙˆØ±</a>
      <button class="ap-btn ap-btn-ghost" onclick="doLogout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
  <div class="ap-tabs">
    <button class="ap-tab active" onclick="apTab('list',this)">ğŸ‘¥ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
    <button class="ap-tab" onclick="apTab('add',this)">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
  </div>
  <div class="ap-body">
    <div class="ap-pane active" id="ap-pane-list">
      <div class="ap-search-row">
        <input class="ap-search" id="ap-search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù…Ø²..." oninput="renderCards()">
        <div class="ap-count" id="ap-count"></div>
      </div>
      <div class="students-grid" id="students-grid"></div>
    </div>
    <div class="ap-pane" id="ap-pane-add">
      <div class="add-form">
        <h3>â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
        <div class="form-grid">
          <div class="form-group full">
            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„</label>
            <input class="form-input" id="new-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø±Ø¨Ø§Ø¹ÙŠ">
          </div>
          <div class="form-group">
            <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ / Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</label>
            <input class="form-input" id="new-id" placeholder="10 Ø£Ø±Ù‚Ø§Ù…" oninput="previewPin()">
          </div>
          <div class="form-group">
            <label class="form-label">Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø¢Ø®Ø± 4 Ø£Ø±Ù‚Ø§Ù…)</label>
            <div class="pin-preview" id="new-pin-preview">â€”â€”</div>
          </div>
          <div class="form-group">
            <label class="form-label">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
            <input class="form-input" id="new-grade" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡">
          </div>
          <div class="form-group">
            <label class="form-label">Ø¬ÙˆØ§Ù„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</label>
            <input class="form-input" id="new-phone" placeholder="05xxxxxxxx" type="tel">
          </div>
        </div>
        <button class="btn-save" style="margin-top:16px;width:100%;" onclick="addStudent()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
      </div>
    </div>
  </div>
</div>

<!-- EDIT MODAL -->
<div id="edit-modal">
  <div class="modal-box">
    <div class="modal-header">
      <h3 id="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h3>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="modal-tabs">
        <button class="modal-tab active" onclick="modalTab('basic',this)">ğŸ‘¤ Ø£Ø³Ø§Ø³ÙŠ</button>
        <button class="modal-tab" onclick="modalTab('details',this)">ğŸ“‹ ØªÙØ§ØµÙŠÙ„</button>
        <button class="modal-tab" onclick="modalTab('plan',this)">ğŸ“š Ø§Ù„Ø®Ø·Ø©</button>
        <button class="modal-tab" onclick="modalTab('followup',this)">ğŸ“Š Ù…ØªØ§Ø¨Ø¹Ø©</button>
      </div>

      <!-- Ø£Ø³Ø§Ø³ÙŠ -->
      <div class="modal-pane active" id="mp-basic">
        <div class="form-grid">
          <div class="form-group full"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label><input class="form-input" id="e-name"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label><input class="form-input" id="e-grade"></div>
          <div class="form-group"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„</label><input class="form-input" id="e-id"></div>
          <div class="form-group"><label class="form-label">Ø¬ÙˆØ§Ù„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</label><input class="form-input" id="e-phone" type="tel"></div>
        </div>
      </div>

      <!-- ØªÙØ§ØµÙŠÙ„ -->
      <div class="modal-pane" id="mp-details">
        <div class="form-grid">
          <div class="form-group"><label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</label><input class="form-input" id="e-birthdate" type="date"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</label><input class="form-input" id="e-nationality"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ø¹Ù…Ø±</label><input class="form-input" id="e-age"></div>
          <div class="form-group"><label class="form-label">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø°ÙƒØ§Ø¡</label><input class="form-input" id="e-iq"></div>
          <div class="form-group full"><label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input class="form-input" id="e-address"></div>
          <div class="form-group"><label class="form-label">ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨ÙŠÙ† Ø¥Ø®ÙˆØªÙ‡</label><input class="form-input" id="e-sibling-order"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ</label>
            <select class="form-input" id="e-economic-level"><option value="">Ø§Ø®ØªØ±...</option><option>Ù…Ù†Ø®ÙØ¶</option><option>Ù…ØªÙˆØ³Ø·</option><option>Ù…Ø±ØªÙØ¹</option></select>
          </div>
          <div class="form-group"><label class="form-label">ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø¨</label>
            <select class="form-input" id="e-father-edu"><option value="">Ø§Ø®ØªØ±...</option><option>Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option><option>Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù†ÙˆÙŠ</option><option>Ø¬Ø§Ù…Ø¹ÙŠ</option><option>Ø¯Ø±Ø§Ø³Ø§Øª Ø¹Ù„ÙŠØ§</option><option>ØºÙŠØ± Ù…ØªØ¹Ù„Ù…</option></select>
          </div>
          <div class="form-group"><label class="form-label">ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ù…</label>
            <select class="form-input" id="e-mother-edu"><option value="">Ø§Ø®ØªØ±...</option><option>Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option><option>Ù…ØªÙˆØ³Ø·</option><option>Ø«Ø§Ù†ÙˆÙŠ</option><option>Ø¬Ø§Ù…Ø¹ÙŠ</option><option>Ø¯Ø±Ø§Ø³Ø§Øª Ø¹Ù„ÙŠØ§</option><option>ØºÙŠØ± Ù…ØªØ¹Ù„Ù…</option></select>
          </div>
          <div class="form-group full"><label class="form-label">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†ÙØ³ÙŠ</label><textarea class="form-input" id="e-status-psych"></textarea></div>
          <div class="form-group full"><label class="form-label">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</label><textarea class="form-input" id="e-status-social"></textarea></div>
          <div class="form-group full"><label class="form-label">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØµØ­ÙŠ</label><textarea class="form-input" id="e-status-health"></textarea></div>
          <div class="form-group full"><label class="form-label">Ø§Ù„ØªØ´Ø®ÙŠØµ</label><textarea class="form-input" id="e-diagnosis"></textarea></div>
          <div class="form-group full"><label class="form-label">Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØªØ±Ø¨ÙˆÙŠ</label><input class="form-input" id="e-program-place"></div>
          <div class="form-group"><label class="form-label">ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</label><input class="form-input" id="e-program-start" placeholder="/   /   1447Ù‡Ù€"></div>
          <div class="form-group"><label class="form-label">ØªØ§Ø±ÙŠØ® Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</label><input class="form-input" id="e-program-end" placeholder="/   /   1447Ù‡Ù€"></div>
        </div>
      </div>

      <!-- Ø§Ù„Ø®Ø·Ø© -->
      <div class="modal-pane" id="mp-plan">
        <div id="plan-editor"></div>
        <button class="btn-add" onclick="addPlanRow()">+ Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù</button>
      </div>

      <!-- Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© -->
      <div class="modal-pane" id="mp-followup">
        <div style="font-size:0.75rem;color:var(--muted);background:#fff8f4;padding:10px;border-radius:8px;margin-bottom:10px;">
          âœ“ Ø­Ù‚Ù‚ &nbsp;|&nbsp; ~ Ø¬Ø²Ø¦ÙŠØ§Ù‹ &nbsp;|&nbsp; âœ— Ù„Ù… ÙŠØ­Ù‚Ù‚
        </div>
        <div class="fu-head">
          <div class="fu-head-cell" style="text-align:right;">Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</div>
          <div class="fu-head-cell">Ù…Ù¡</div><div class="fu-head-cell">Ù…Ù¢</div>
          <div class="fu-head-cell">Ù…Ù£</div>
          <div class="fu-head-cell col-m4">Ù…Ù¤</div>
          <div class="fu-head-cell col-m5">Ù…Ù¥</div>
          <div></div>
        </div>
        <div id="fu-editor"></div>
        <button class="btn-add" onclick="addFuRow()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ø§Ø±Ø©</button>
      </div>

      <div class="modal-actions">
        <button class="btn-delete" onclick="deleteStudent()">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        <button class="btn-cancel" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="btn-save" onclick="saveEdits()">ğŸ’¾ Ø­ÙØ¸</button>
      </div>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SB_URL    = 'https://pyrxwqgapwjwhiskowhk.supabase.co';
const SB_KEY    = 'sb_publishable_bfe-B4f-Rag1SR0-PoIb9w_nMfA1Ere';
const PROG      = 'dumaj';
const ADMIN_PIN = '7410';
const PHOTOS_BASE = `${SB_URL}/storage/v1/object/public/reports/${PROG}/photos/`;
const DATA_BASE   = `${SB_URL}/storage/v1/object/public/reports/${PROG}/data/`;
const DATA_UPLOAD = `${SB_URL}/storage/v1/object/reports/${PROG}/data/`;
const SB_HEADERS  = { 'apikey': SB_KEY, 'Authorization': 'Bearer ' + SB_KEY };

const STUDENTS = {
  "7405": { name:"Ø§ÙŠØ§Ø¯ Ù…ÙˆØ³Ù‰ Ø­ÙˆÙ„ÙŠ Ø§Ù„Ù‚Ø±Ù†ÙŠ",               id_full:"1152837405", grade:"Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",   phone:"0500000000" },
  "4526": { name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ØµØ§Ù„Ø­ Ø£Ø­Ù…Ø¯ Ø§Ù„Ù…Ø´Ø¬Ø±ÙŠ",           id_full:"2297474526", grade:"Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",   phone:"0500000000" },
  "9050": { name:"Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯ Ù…Ø·Ø± Ø§Ù„Ø³Ù‡ÙŠÙ…ÙŠ",                id_full:"1158819050", grade:"Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",   phone:"0500000000" },
  "4612": { name:"Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…Ù†ØªØ´Ø±ÙŠ",              id_full:"1153884612", grade:"Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",   phone:"0500000000" },
  "0977": { name:"Ù…Ø´Ø§Ø±ÙŠ ÙÙŠØ­Ø§Ù† Ø³Ù…ÙŠØ­ Ø§Ù„Ø¨Ù‚Ù…ÙŠ",             id_full:"1149660977", grade:"Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",   phone:"0500000000" },
  "6630": { name:"ÙŠØ²Ù† Ù…Ø­Ù…Ø¯ Ù…ØµÙ„Ø­ Ø³Ù„Ø§Ù…ÙŠ",                 id_full:"1166376630", grade:"Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",   phone:"0500000000" },
  "7543": { name:"Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø¹Ø·ÙŠ Ø§Ù„Ø¬Ø¯Ø¹Ø§Ù†ÙŠ",          id_full:"1151467543", grade:"Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "4218": { name:"Ø±Ø§ÙƒØ§Ù† Ø³Ù…ÙŠØ± ÙÙ‚ÙŠÙ‡ÙŠ Ø§Ù„ÙŠÙ…Ø§Ù†ÙŠ",            id_full:"1205014218", grade:"Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "7892": { name:"Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø­Ø³Ù† Ø³Ø¹Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ",         id_full:"1144197892", grade:"Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "4304": { name:"ÙÙ‡Ø¯ Ø¹Ù„ÙŠ Ø­Ø³ÙŠÙ† Ø§Ù„ØµÙˆÙ…Ø§Ù„ÙŠ",               id_full:"1160744304", grade:"Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "4511": { name:"Ø­Ø³Ù† Ø®Ø§Ù„Ø¯ Ø­Ø³Ù† ØµØºÙŠØ±",                  id_full:"1150674511", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "6984": { name:"Ø®Ø§Ù„Ø¯ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ù…Ù†ØµÙˆØ± Ø§Ù„Ø¹Ø§Ù…Ø±ÙŠ",          id_full:"1159536984", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "5210": { name:"Ø³Ø§Ù…ÙŠ Ø§Ù‚Ø¨Ø§Ù„ Ø£Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯",                id_full:"2293985210", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "4447": { name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ø­Ù…Ø¯ Ø¨Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ",   id_full:"1157024447", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "5460": { name:"Ù…Ø§Ø¬Ø¯ Ù†Ø§Ø¯Ø± Ø£Ø­Ù…Ø¯ Ø¹ÙŠØ³Ù‰",                 id_full:"1162795460", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "7907": { name:"Ù…Ø­Ù…Ø¯ Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø·ÙˆØ§Ø´ÙŠ",           id_full:"1148347907", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "8315": { name:"Ù…Ø´Ø§Ø±ÙŠ Ø®Ù„ÙŠÙ„ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ",        id_full:"1204218315", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "2407": { name:"Ù…Ù‡Ù†Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù‡Ø±ÙŠ",            id_full:"1145092407", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "9867": { name:"Ù…Ø¤ÙŠØ¯ Ù…Ø´Ø¹Ù„ Ø¹Ù„ÙŠ Ø§Ù„Ø¹Ù…Ø±ÙŠ",                id_full:"1137239867", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "2335": { name:"Ù…Ø¤ÙŠØ¯ Ù†Ø¹ÙŠÙ… Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¨Ø¯ÙŠØ±",              id_full:"2288502335", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
  "9258": { name:"ÙˆÙ„ÙŠØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ÙŠØ­ÙŠ Ø§Ù„Ø´Ù‡Ø±ÙŠ",             id_full:"1152469258", grade:"Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ù…ØªÙˆØ³Ø· / Ù¡",  phone:"0500000000" },
};

const DETAIL_FIELDS = [
  'birthdate','nationality','age','address','iq','sibling_order',
  'economic_level','father_edu','mother_edu','status_psych',
  'status_social','status_health','diagnosis','program_place',
  'program_start','program_end'
];
const DETAIL_LABELS = {
  birthdate:'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯', nationality:'Ø§Ù„Ø¬Ù†Ø³ÙŠØ©', age:'Ø§Ù„Ø¹Ù…Ø±', address:'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†',
  iq:'Ø¯Ø±Ø¬Ø© Ø§Ù„Ø°ÙƒØ§Ø¡', sibling_order:'ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨ÙŠÙ† Ø¥Ø®ÙˆØªÙ‡',
  economic_level:'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ÙŠ', father_edu:'ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø¨', mother_edu:'ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ù…',
  status_psych:'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†ÙØ³ÙŠ', status_social:'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ', status_health:'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØµØ­ÙŠ',
  diagnosis:'Ø§Ù„ØªØ´Ø®ÙŠØµ', program_place:'Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØªØ±Ø¨ÙˆÙŠ',
  program_start:'ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬', program_end:'ØªØ§Ø±ÙŠØ® Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬'
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUPABASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function sbSave(pin) {
  const s = STUDENTS[pin];
  const payload = {
    pin, name:s.name, id_full:s.id_full, grade:s.grade, phone:s.phone||'',
    plan:s.plan||[], followup:s.followup||[], reports:s.reports||[]
  };
  DETAIL_FIELDS.forEach(f => payload[f] = s[f]||'');
  const blob = new Blob([JSON.stringify(payload)], {type:'application/json'});
  const res = await fetch(`${DATA_UPLOAD}student-${pin}.json`, {
    method:'POST',
    headers:{ ...SB_HEADERS, 'Content-Type':'application/json', 'x-upsert':'true' },
    body: blob
  });
  return res.ok;
}

async function sbLoad(pin) {
  try {
    const res = await fetch(`${DATA_BASE}student-${pin}.json?t=${Date.now()}`);
    if (!res.ok) return false;
    const data = await res.json();
    if (!data || !STUDENTS[pin]) return false;
    const s = STUDENTS[pin];
    if (data.name)    s.name    = data.name;
    if (data.grade)   s.grade   = data.grade;
    if (data.id_full) s.id_full = data.id_full;
    s.phone    = data.phone    || s.phone || '';
    s.plan     = data.plan     || s.plan  || [];
    s.followup = data.followup || s.followup || [];
    s.reports  = data.reports  || s.reports  || [];
    DETAIL_FIELDS.forEach(f => { s[f] = data[f] !== undefined ? data[f] : (s[f]||''); });
    return true;
  } catch(e) { return false; }
}

async function sbLoadAll() {
  await Promise.all(Object.keys(STUDENTS).map(pin => sbLoad(pin)));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentPin = null;

function doLogin() {
  const pin = document.getElementById('pin-input').value.trim();
  const err = document.getElementById('login-error');
  const inp = document.getElementById('pin-input');
  if (pin === ADMIN_PIN) {
    inp.classList.remove('error'); err.classList.remove('show');
    openAdmin();
  } else if (STUDENTS[pin]) {
    inp.classList.remove('error'); err.classList.remove('show');
    openStudent(pin);
  } else {
    inp.classList.add('error'); err.classList.add('show');
    inp.value = '';
    setTimeout(() => inp.classList.remove('error'), 500);
  }
}

function doLogout() {
  currentPin = null;
  document.getElementById('student-portal').style.display = 'none';
  document.getElementById('admin-portal').style.display   = 'none';
  document.getElementById('login-screen').style.display   = 'flex';
  document.getElementById('pin-input').value = '';
  document.getElementById('login-error').classList.remove('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STUDENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function openStudent(pin) {
  currentPin = pin;
  document.getElementById('login-screen').style.display   = 'none';
  document.getElementById('student-portal').style.display = 'block';
  showToast('â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
  await sbLoad(pin);
  renderStudentView(pin);
  showToast('âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„');
  loadPhoto(pin);
}

function renderStudentView(pin) {
  const s = STUDENTS[pin];
  document.getElementById('sp-name').textContent = s.name;
  document.getElementById('sp-meta').textContent = `ğŸ§  Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„ÙÙƒØ±ÙŠ Â· ${s.grade}`;

  document.getElementById('info-basic').innerHTML = [
    ['Ø§Ù„Ø§Ø³Ù…', s.name], ['Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„', s.id_full], ['Ø§Ù„ØµÙ', s.grade],
    ['Ø¬ÙˆØ§Ù„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±', s.phone ? `<a href="tel:${s.phone}" style="color:var(--orange);font-weight:700;">${s.phone}</a>` : 'â€”'],
    ['Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬', '<span style="background:#fff8f4;color:var(--orange);padding:3px 10px;border-radius:20px;font-size:0.78rem;font-weight:700;">ğŸ§  Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„ÙÙƒØ±ÙŠ</span>'],
    ['Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ','1447Ù‡Ù€'], ['Ø§Ù„ÙØµÙ„','Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ'],
  ].map(([l,v]) => `<div class="info-row"><span class="info-label">${l}</span><span class="info-value">${v||'â€”'}</span></div>`).join('');

  const detailRows = DETAIL_FIELDS.filter(f => s[f]).map(f =>
    `<div class="info-row"><span class="info-label">${DETAIL_LABELS[f]}</span><span class="info-value">${s[f]}</span></div>`
  ).join('');
  const dc = document.getElementById('info-details-card');
  if (detailRows) { document.getElementById('info-details').innerHTML = detailRows; dc.style.display='block'; }
  else dc.style.display = 'none';

  const plan = s.plan||[];
  document.getElementById('sp-plan-list').innerHTML = plan.length
    ? plan.map(g=>`<div class="plan-card"><div class="plan-card-title">ğŸ¯ ${g.title}</div><div class="plan-card-desc">${g.desc||''}</div></div>`).join('')
    : '<div style="text-align:center;color:var(--muted);padding:30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‡Ø¯Ø§Ù Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯</div>';

  const fu = s.followup||[];
  if (fu.length) {
    document.getElementById('sp-fu-table').innerHTML = `
      <thead><tr><th>Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</th><th>Ù…Ù¡</th><th>Ù…Ù¢</th><th>Ù…Ù£</th><th>Ù…Ù¤</th><th>Ù…Ù¥</th></tr></thead>
      <tbody>${fu.map(r=>`<tr><td style="text-align:right;">${r.skill}</td>${['m1','m2','m3','m4','m5'].map(m=>{const v=r[m]||'~';const c=v==='âœ“'?'fu-val-check':v==='âœ—'?'fu-val-no':'fu-val-part';return`<td class="${c}">${v}</td>`}).join('')}</tr>`).join('')}</tbody>`;
  } else {
    document.getElementById('sp-fu-table').innerHTML = '<tbody><tr><td colspan="6" style="padding:20px;text-align:center;color:var(--muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr></tbody>';
  }
  renderReports(pin);
}

function loadPhoto(pin) {
  const img = document.getElementById('sp-photo-img');
  const emoji = document.getElementById('sp-photo-emoji');
  const test = new Image();
  test.onload  = () => { img.src=`${PHOTOS_BASE}${pin}.jpg?t=${Date.now()}`; img.style.display='block'; emoji.style.display='none'; };
  test.onerror = () => { img.style.display='none'; emoji.style.display='flex'; };
  test.src = `${PHOTOS_BASE}${pin}.jpg?t=${Date.now()}`;
}

async function uploadPhoto(input) {
  const file = input.files[0]; if (!file) return;
  showToast('â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©...');
  const res = await fetch(`${SB_URL}/storage/v1/object/reports/${PROG}/photos/${currentPin}.jpg`, {
    method:'POST', headers:{ ...SB_HEADERS, 'Content-Type':file.type, 'x-upsert':'true' }, body:file
  });
  if (res.ok) { loadPhoto(currentPin); showToast('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©'); }
  else showToast('âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©');
}

function renderReports(pin) {
  const base = `${SB_URL}/storage/v1/object/public/reports/${PROG}/reports/${pin}/`;
  document.getElementById('sp-reports-list').innerHTML = `
    <div class="pdf-section">
      <div class="pdf-title">ğŸ“‹ Ø§Ù„Ø®Ø·Ø© Ø§Ù„ÙØ±Ø¯ÙŠØ©</div>
      <label class="pdf-upload-btn" for="upload-plan">ğŸ“¤ Ø±ÙØ¹ Ù…Ù„Ù PDF</label>
      <input type="file" id="upload-plan" accept=".pdf" style="display:none" onchange="uploadReport(this,'plan')">
      <iframe class="pdf-iframe" src="${base}plan.pdf" onerror="this.style.display='none'"></iframe>
    </div>
    <div class="pdf-section">
      <div class="pdf-title">ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</div>
      <label class="pdf-upload-btn" for="upload-report">ğŸ“¤ Ø±ÙØ¹ Ù…Ù„Ù PDF</label>
      <input type="file" id="upload-report" accept=".pdf" style="display:none" onchange="uploadReport(this,'report')">
      <iframe class="pdf-iframe" src="${base}report.pdf" onerror="this.style.display='none'"></iframe>
    </div>`;
}

async function uploadReport(input, type) {
  const file = input.files[0]; if (!file) return;
  showToast('â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù...');
  const res = await fetch(`${SB_URL}/storage/v1/object/reports/${PROG}/reports/${currentPin}/${type}.pdf`, {
    method:'POST', headers:{ ...SB_HEADERS, 'Content-Type':'application/pdf', 'x-upsert':'true' }, body:file
  });
  if (res.ok) { showToast('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù'); setTimeout(()=>renderReports(currentPin),1000); }
  else showToast('âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function openAdmin() {
  document.getElementById('login-screen').style.display  = 'none';
  document.getElementById('admin-portal').style.display  = 'block';
  showToast('â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨...');
  await sbLoadAll();
  renderCards();
  showToast('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
}

function renderCards() {
  const q = (document.getElementById('ap-search')?.value||'').toLowerCase();
  const entries = Object.entries(STUDENTS).filter(([pin,s]) =>
    s.name.toLowerCase().includes(q) || pin.includes(q)
  ).sort((a,b) => a[1].grade.localeCompare(b[1].grade,'ar'));

  document.getElementById('students-grid').innerHTML = entries.map(([pin,s],i) => `
    <div class="stu-card" onclick="openEdit('${pin}')">
      <div class="stu-card-num">${i+1}</div>
      <div style="flex:1;min-width:0;">
        <div class="stu-card-name">${s.name}</div>
        <div class="stu-card-meta">${s.grade}</div>
        <div style="margin-top:4px;display:flex;gap:6px;align-items:center;">
          <span class="stu-card-pin">${pin}</span>
          <span style="font-size:0.7rem;color:var(--muted);">${s.phone||'â€”'}</span>
        </div>
      </div>
      <span style="color:var(--muted);">âœï¸</span>
    </div>`).join('');

  document.getElementById('ap-count').textContent = `${Object.keys(STUDENTS).length} Ø·Ø§Ù„Ø¨`;
}

function previewPin() {
  const id = document.getElementById('new-id').value.trim();
  document.getElementById('new-pin-preview').textContent = id.length>=4 ? id.slice(-4) : 'â€”â€”';
}

async function addStudent() {
  const name=document.getElementById('new-name').value.trim();
  const id=document.getElementById('new-id').value.trim();
  const grade=document.getElementById('new-grade').value.trim();
  const phone=document.getElementById('new-phone').value.trim();
  if (!name||!id||!grade) { showToast('âŒ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¬Ù„ ÙˆØ§Ù„ØµÙ'); return; }
  if (id.length<4) { showToast('âŒ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ù‚ØµÙŠØ±'); return; }
  const pin = id.slice(-4);
  if (STUDENTS[pin]) { showToast(`âŒ Ø§Ù„Ø±Ù…Ø² ${pin} Ù…Ø³ØªØ®Ø¯Ù…`); return; }
  STUDENTS[pin] = { name, id_full:id, grade, phone, plan:[], followup:[], reports:[] };
  DETAIL_FIELDS.forEach(f => { STUDENTS[pin][f]=''; });
  showToast('â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...');
  const ok = await sbSave(pin);
  if (ok) {
    showToast(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${name} â€” Ø§Ù„Ø±Ù…Ø²: ${pin}`);
    ['new-name','new-id','new-grade','new-phone'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('new-pin-preview').textContent='â€”â€”';
    apTab('list',document.querySelector('.ap-tab'));
    renderCards();
  } else showToast('âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EDIT MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let editingPin = null;

async function openEdit(pin) {
  editingPin = pin;
  showToast('â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
  await sbLoad(pin);
  const s = STUDENTS[pin];
  document.getElementById('modal-title').textContent = 'âœï¸ ' + s.name;

  document.getElementById('e-name').value  = s.name||'';
  document.getElementById('e-grade').value = s.grade||'';
  document.getElementById('e-id').value    = s.id_full||'';
  document.getElementById('e-phone').value = s.phone||'';
  document.getElementById('e-birthdate').value      = s.birthdate||'';
  document.getElementById('e-nationality').value    = s.nationality||'';
  document.getElementById('e-age').value            = s.age||'';
  document.getElementById('e-iq').value             = s.iq||'';
  document.getElementById('e-address').value        = s.address||'';
  document.getElementById('e-sibling-order').value  = s.sibling_order||'';
  document.getElementById('e-economic-level').value = s.economic_level||'';
  document.getElementById('e-father-edu').value     = s.father_edu||'';
  document.getElementById('e-mother-edu').value     = s.mother_edu||'';
  document.getElementById('e-status-psych').value   = s.status_psych||'';
  document.getElementById('e-status-social').value  = s.status_social||'';
  document.getElementById('e-status-health').value  = s.status_health||'';
  document.getElementById('e-diagnosis').value      = s.diagnosis||'';
  document.getElementById('e-program-place').value  = s.program_place||'';
  document.getElementById('e-program-start').value  = s.program_start||'';
  document.getElementById('e-program-end').value    = s.program_end||'';

  renderPlanEditor(s.plan||[]);
  renderFuEditor(s.followup||[]);
  modalTab('basic', document.querySelector('#edit-modal .modal-tab'));
  document.getElementById('edit-modal').classList.add('open');
  showToast('');
}

async function saveEdits() {
  if (!editingPin) return;
  const s = STUDENTS[editingPin];
  s.name    = document.getElementById('e-name').value.trim()  || s.name;
  s.grade   = document.getElementById('e-grade').value.trim() || s.grade;
  s.id_full = document.getElementById('e-id').value.trim()    || s.id_full;
  s.phone   = document.getElementById('e-phone').value.trim();
  s.birthdate      = document.getElementById('e-birthdate').value.trim();
  s.nationality    = document.getElementById('e-nationality').value.trim();
  s.age            = document.getElementById('e-age').value.trim();
  s.iq             = document.getElementById('e-iq').value.trim();
  s.address        = document.getElementById('e-address').value.trim();
  s.sibling_order  = document.getElementById('e-sibling-order').value.trim();
  s.economic_level = document.getElementById('e-economic-level').value;
  s.father_edu     = document.getElementById('e-father-edu').value;
  s.mother_edu     = document.getElementById('e-mother-edu').value;
  s.status_psych   = document.getElementById('e-status-psych').value.trim();
  s.status_social  = document.getElementById('e-status-social').value.trim();
  s.status_health  = document.getElementById('e-status-health').value.trim();
  s.diagnosis      = document.getElementById('e-diagnosis').value.trim();
  s.program_place  = document.getElementById('e-program-place').value.trim();
  s.program_start  = document.getElementById('e-program-start').value.trim();
  s.program_end    = document.getElementById('e-program-end').value.trim();

  s.plan = [];
  document.querySelectorAll('[data-plan-title]').forEach((el,i) => {
    const title = el.value.trim();
    const desc  = document.querySelectorAll('[data-plan-desc]')[i]?.value.trim()||'';
    if (title) s.plan.push({title,desc,color:'#c25a00'});
  });

  s.followup = [];
  document.querySelectorAll('[data-fu-skill]').forEach((el,i) => {
    const skill = el.value.trim(); if (!skill) return;
    s.followup.push({
      skill,
      m1:document.querySelectorAll('[data-fu-m1]')[i]?.value||'~',
      m2:document.querySelectorAll('[data-fu-m2]')[i]?.value||'~',
      m3:document.querySelectorAll('[data-fu-m3]')[i]?.value||'~',
      m4:document.querySelectorAll('[data-fu-m4]')[i]?.value||'~',
      m5:document.querySelectorAll('[data-fu-m5]')[i]?.value||'~',
    });
  });

  closeModal();
  renderCards();
  showToast('â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...');
  const ok = await sbSave(editingPin);
  showToast(ok ? 'âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª ' + s.name : 'âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ â€” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„');
}

async function deleteStudent() {
  if (!editingPin) return;
  const name = STUDENTS[editingPin].name;
  if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ ${name}ØŸ`)) return;
  delete STUDENTS[editingPin];
  closeModal(); renderCards();
  showToast('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨');
}

function closeModal() {
  document.getElementById('edit-modal').classList.remove('open');
  editingPin = null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAN EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPlanEditor(plan) {
  document.getElementById('plan-editor').innerHTML = plan.map((g,i)=>planRowHTML(g.title,g.desc,i)).join('');
}
function planRowHTML(title,desc,i) {
  return `<div class="plan-row" id="plan-row-${i}">
    <input class="form-input" data-plan-title="${i}" value="${(title||'').replace(/"/g,'&quot;')}" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‡Ø¯Ù">
    <input class="form-input" data-plan-desc="${i}"  value="${(desc||'').replace(/"/g,'&quot;')}"  placeholder="ÙˆØµÙ Ø§Ù„Ù‡Ø¯Ù">
    <button class="plan-row-del" onclick="this.closest('[id^=plan-row]').remove()">âœ•</button>
  </div>`;
}
function addPlanRow() {
  document.getElementById('plan-editor').insertAdjacentHTML('beforeend', planRowHTML('','',Date.now()));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FOLLOWUP EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFuEditor(fu) {
  document.getElementById('fu-editor').innerHTML = fu.map((r,i)=>fuRowHTML(r,i)).join('');
}
function fuRowHTML(r,i) {
  const sel=(key)=>`<select class="fu-select" data-fu-${key}="${i}">${['âœ“','~','âœ—'].map(v=>`<option value="${v}" ${(r?.[key]||'~')===v?'selected':''}>${v}</option>`).join('')}</select>`;
  return `<div class="fu-editor-row" id="fu-row-${i}">
    <input class="form-input" data-fu-skill="${i}" value="${(r?.skill||'').replace(/"/g,'&quot;')}" placeholder="Ø§Ù„Ù…Ù‡Ø§Ø±Ø©" style="font-size:0.78rem;padding:6px 8px;">
    ${sel('m1')}${sel('m2')}${sel('m3')}
    <span class="col-m4">${sel('m4')}</span>
    <span class="col-m5">${sel('m5')}</span>
    <button class="plan-row-del" onclick="this.closest('[id^=fu-row]').remove()">âœ•</button>
  </div>`;
}
function addFuRow() {
  document.getElementById('fu-editor').insertAdjacentHTML('beforeend', fuRowHTML(null,Date.now()));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function spTab(id,btn) {
  document.querySelectorAll('.sp-pane').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.sp-tab').forEach(b=>b.classList.remove('active'));
  document.getElementById('sp-pane-'+id).classList.add('active'); btn.classList.add('active');
}
function apTab(id,btn) {
  document.querySelectorAll('.ap-pane').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.ap-tab').forEach(b=>b.classList.remove('active'));
  document.getElementById('ap-pane-'+id).classList.add('active'); btn.classList.add('active');
}
function modalTab(id,btn) {
  document.querySelectorAll('.modal-pane').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.modal-tab').forEach(b=>b.classList.remove('active'));
  document.getElementById('mp-'+id).classList.add('active'); btn.classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTimer = null;
function showToast(msg) {
  const t = document.getElementById('toast');
  if (!msg) { t.classList.remove('show'); return; }
  t.textContent = msg; t.classList.add('show');
  clearTimeout(toastTimer);
  if (!msg.includes('â³')) toastTimer = setTimeout(()=>t.classList.remove('show'), 3000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('pin-input').addEventListener('keydown', e => {
  if (e.key==='Enter') doLogin();
});
document.getElementById('edit-modal').addEventListener('click', e => {
  if (e.target===document.getElementById('edit-modal')) closeModal();
});
</script>
</body>
</html>
